.PHONY: clean bump build upload upload-test test-release help

help:
	@echo "SimExp MCP Build & Release Automation"
	@echo "====================================="
	@echo ""
	@echo "Development Commands:"
	@echo "  make clean              Remove build artifacts (build/, dist/, *.egg-info)"
	@echo "  make bump               Auto-increment patch version"
	@echo "  make build              Create wheel and source distributions"
	@echo ""
	@echo "Release Commands:"
	@echo "  make upload             Upload to production PyPI"
	@echo "  make upload-test        Upload to TestPyPI"
	@echo ""
	@echo "Combined Workflows:"
	@echo "  make test-release       FULL AUTOMATION: bump + clean + build + upload-test"
	@echo ""

clean:
	@echo "ðŸ§¹ Cleaning build artifacts..."
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	@echo "âœ… Clean complete"

bump:
	@echo "ðŸ“¦ Bumping version..."
	python3 ../bump.py mcp patch
	@echo "âœ… Version bumped"

build: clean
	@echo "ðŸ”¨ Building distributions..."
	python3 -m build
	@echo "âœ… Build complete"
	@echo ""
	@echo "ðŸ“‹ Checking package integrity..."
	twine check dist/*
	@echo "âœ… Package check passed"

upload: build
	@echo "ðŸš€ Uploading to production PyPI..."
	twine upload dist/*
	@echo "âœ… Upload complete"

upload-test: build
	@echo "ðŸ§ª Uploading to TestPyPI..."
	twine upload --repository testpypi dist/*
	@echo "âœ… TestPyPI upload complete"

test-release: bump build upload-test
	@echo ""
	@echo "âœ¨ Full test release workflow complete!"
	@echo "   Version updated, built, and uploaded to TestPyPI"
	@echo ""
	@echo "Next steps:"
	@echo "  1. Test installation: pip install -i https://test.pypi.org/simple/ simexp-mcp"
	@echo "  2. Verify functionality with: simexp-mcp --help"
	@echo "  3. If successful, run: make upload"

.PHONY: clean bump build upload upload-test test-release help
